version: 2.1

orbs:
  docker: circleci/docker@2.2.0
  cli: digitalocean/cli@0.1.1

executors:
  docker:
    environment:
      DOCKER_HUB_USERNAME: ${{ secrets.DOCKER_HUB_USERNAME }}
      DOCKER_HUB_PASSWORD: ${{ secrets.DOCKER_HUB_PASSWORD }}
    docker:
      - image: docker:stable

jobs:
  deploy:
    description: |
      Install doctl and initialize to connect to DigitalOcean
    executor: doctl/default
    parameters:
      executor:
        default: default
        description: |
          Executor to use for this job. Defaults to this orb's default executor.
        type: executor
      digitalocean-access-token:
        default: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }} 
        description: The access token to connect DigitalOcean
        type: env_var_name
    steps:
      - install
      - initialize:
          digitalocean-access-token: <<parameters.digitalocean-access-token>> 
            
